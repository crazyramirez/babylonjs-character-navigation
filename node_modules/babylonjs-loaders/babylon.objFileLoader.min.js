!function(t,e){"object"==typeof exports&&"object"==typeof module?module.exports=e(require("babylonjs")):"function"==typeof define&&define.amd?define("babylonjs-loaders",["babylonjs"],e):"object"==typeof exports?exports["babylonjs-loaders"]=e(require("babylonjs")):t.LOADERS=e(t.BABYLON)}("undefined"!=typeof self?self:"undefined"!=typeof global?global:this,(t=>(()=>{"use strict";var e={520:e=>{e.exports=t}},s={};function i(t){var r=s[t];if(void 0!==r)return r.exports;var o=s[t]={exports:{}};return e[t](o,o.exports,i),o.exports}i.d=(t,e)=>{for(var s in e)i.o(e,s)&&!i.o(t,s)&&Object.defineProperty(t,s,{enumerable:!0,get:e[s]})},i.g=function(){if("object"==typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(t){if("object"==typeof window)return window}}(),i.o=(t,e)=>Object.prototype.hasOwnProperty.call(t,e),i.r=t=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})};var r={};return(()=>{i.d(r,{default:()=>p});var t={};i.r(t),i.d(t,{MTLFileLoader:()=>o,OBJFileLoader:()=>n,SolidParser:()=>a});var e={};i.r(e),i.d(e,{MTLFileLoader:()=>o,OBJFileLoader:()=>n,SolidParser:()=>a});var s=i(520),o=function(){function t(){this.materials=[]}return t.prototype.parseMTL=function(e,i,r,o){if(!(i instanceof ArrayBuffer)){for(var a,n=i.split("\n"),l=/\s+/,h=null,p=0;p<n.length;p++){var _=n[p].trim();if(0!==_.length&&"#"!==_.charAt(0)){var d=_.indexOf(" "),u=d>=0?_.substring(0,d):_;u=u.toLowerCase();var m=d>=0?_.substring(d+1).trim():"";if("newmtl"===u)h&&this.materials.push(h),e._blockEntityCollection=!!o,(h=new s.StandardMaterial(m,e))._parentContainer=o,e._blockEntityCollection=!1;else if("kd"===u&&h)a=m.split(l,3).map(parseFloat),h.diffuseColor=s.Color3.FromArray(a);else if("ka"===u&&h)a=m.split(l,3).map(parseFloat),h.ambientColor=s.Color3.FromArray(a);else if("ks"===u&&h)a=m.split(l,3).map(parseFloat),h.specularColor=s.Color3.FromArray(a);else if("ke"===u&&h)a=m.split(l,3).map(parseFloat),h.emissiveColor=s.Color3.FromArray(a);else if("ns"===u&&h)h.specularPower=parseFloat(m);else if("d"===u&&h)h.alpha=parseFloat(m);else if("map_ka"===u&&h)h.ambientTexture=t._GetTexture(r,m,e);else if("map_kd"===u&&h)h.diffuseTexture=t._GetTexture(r,m,e);else if("map_ks"===u&&h)h.specularTexture=t._GetTexture(r,m,e);else if("map_ns"===u);else if("map_bump"===u&&h){var c=m.split(l),f=c.indexOf("-bm"),b=null;f>=0&&(b=c[f+1],c.splice(f,2)),h.bumpTexture=t._GetTexture(r,c.join(" "),e),h.bumpTexture&&null!==b&&(h.bumpTexture.level=parseFloat(b))}else"map_d"===u&&h&&(h.opacityTexture=t._GetTexture(r,m,e))}}h&&this.materials.push(h)}},t._GetTexture=function(e,i,r){if(!i)return null;var o=e;if("file:"===e){var a=i.lastIndexOf("\\");-1===a&&(a=i.lastIndexOf("/")),o+=a>-1?i.substr(a+1):i}else o+=i;return new s.Texture(o,r,!1,t.INVERT_TEXTURE_Y)},t.INVERT_TEXTURE_Y=!0,t}(),a=function(){function t(t,e,i){this._positions=[],this._normals=[],this._uvs=[],this._colors=[],this._meshesFromObj=[],this._indicesForBabylon=[],this._wrappedPositionForBabylon=[],this._wrappedUvsForBabylon=[],this._wrappedColorsForBabylon=[],this._wrappedNormalsForBabylon=[],this._tuplePosNorm=[],this._curPositionInIndices=0,this._hasMeshes=!1,this._unwrappedPositionsForBabylon=[],this._unwrappedColorsForBabylon=[],this._unwrappedNormalsForBabylon=[],this._unwrappedUVForBabylon=[],this._triangles=[],this._materialNameFromObj="",this._objMeshName="",this._increment=1,this._isFirstMaterial=!0,this._grayColor=new s.Color4(.5,.5,.5,1),this._materialToUse=t,this._babylonMeshesArray=e,this._loadingOptions=i}return t.prototype._isInArray=function(t,e){t[e[0]]||(t[e[0]]={normals:[],idx:[]});var s=t[e[0]].normals.indexOf(e[1]);return-1===s?-1:t[e[0]].idx[s]},t.prototype._isInArrayUV=function(t,e){t[e[0]]||(t[e[0]]={normals:[],idx:[],uv:[]});var s=t[e[0]].normals.indexOf(e[1]);return 1!=s&&e[2]===t[e[0]].uv[s]?t[e[0]].idx[s]:-1},t.prototype._setData=function(t,e,s,i,r,o,a){var n;-1===(n=this._loadingOptions.optimizeWithUV?this._isInArrayUV(this._tuplePosNorm,[t,s,e]):this._isInArray(this._tuplePosNorm,[t,s]))?(this._indicesForBabylon.push(this._wrappedPositionForBabylon.length),this._wrappedPositionForBabylon.push(i),this._wrappedUvsForBabylon.push(r),this._wrappedNormalsForBabylon.push(o),void 0!==a&&this._wrappedColorsForBabylon.push(a),this._tuplePosNorm[t].normals.push(s),this._tuplePosNorm[t].idx.push(this._curPositionInIndices++),this._loadingOptions.optimizeWithUV&&this._tuplePosNorm[t].uv.push(e)):this._indicesForBabylon.push(n)},t.prototype._unwrapData=function(){for(var t=0;t<this._wrappedPositionForBabylon.length;t++)this._unwrappedPositionsForBabylon.push(this._wrappedPositionForBabylon[t].x,this._wrappedPositionForBabylon[t].y,this._wrappedPositionForBabylon[t].z),this._unwrappedNormalsForBabylon.push(this._wrappedNormalsForBabylon[t].x,this._wrappedNormalsForBabylon[t].y,this._wrappedNormalsForBabylon[t].z),this._unwrappedUVForBabylon.push(this._wrappedUvsForBabylon[t].x,this._wrappedUvsForBabylon[t].y),this._loadingOptions.importVertexColors&&this._unwrappedColorsForBabylon.push(this._wrappedColorsForBabylon[t].r,this._wrappedColorsForBabylon[t].g,this._wrappedColorsForBabylon[t].b,this._wrappedColorsForBabylon[t].a);this._wrappedPositionForBabylon.length=0,this._wrappedNormalsForBabylon.length=0,this._wrappedUvsForBabylon.length=0,this._wrappedColorsForBabylon.length=0,this._tuplePosNorm.length=0,this._curPositionInIndices=0},t.prototype._getTriangles=function(t,e){for(var s=e;s<t.length-1;s++)this._triangles.push(t[0],t[s],t[s+1])},t.prototype._setDataForCurrentFaceWithPattern1=function(t,e){this._getTriangles(t,e);for(var i=0;i<this._triangles.length;i++){var r=parseInt(this._triangles[i])-1;this._setData(r,0,0,this._positions[r],s.Vector2.Zero(),s.Vector3.Up(),this._loadingOptions.importVertexColors?this._colors[r]:void 0)}this._triangles.length=0},t.prototype._setDataForCurrentFaceWithPattern2=function(t,e){this._getTriangles(t,e);for(var i=0;i<this._triangles.length;i++){var r=this._triangles[i].split("/"),o=parseInt(r[0])-1,a=parseInt(r[1])-1;this._setData(o,a,0,this._positions[o],this._uvs[a],s.Vector3.Up(),this._loadingOptions.importVertexColors?this._colors[o]:void 0)}this._triangles.length=0},t.prototype._setDataForCurrentFaceWithPattern3=function(t,e){this._getTriangles(t,e);for(var s=0;s<this._triangles.length;s++){var i=this._triangles[s].split("/"),r=parseInt(i[0])-1,o=parseInt(i[1])-1,a=parseInt(i[2])-1;this._setData(r,o,a,this._positions[r],this._uvs[o],this._normals[a])}this._triangles.length=0},t.prototype._setDataForCurrentFaceWithPattern4=function(t,e){this._getTriangles(t,e);for(var i=0;i<this._triangles.length;i++){var r=this._triangles[i].split("//"),o=parseInt(r[0])-1,a=parseInt(r[1])-1;this._setData(o,1,a,this._positions[o],s.Vector2.Zero(),this._normals[a],this._loadingOptions.importVertexColors?this._colors[o]:void 0)}this._triangles.length=0},t.prototype._setDataForCurrentFaceWithPattern5=function(t,e){this._getTriangles(t,e);for(var s=0;s<this._triangles.length;s++){var i=this._triangles[s].split("/"),r=this._positions.length+parseInt(i[0]),o=this._uvs.length+parseInt(i[1]),a=this._normals.length+parseInt(i[2]);this._setData(r,o,a,this._positions[r],this._uvs[o],this._normals[a],this._loadingOptions.importVertexColors?this._colors[r]:void 0)}this._triangles.length=0},t.prototype._addPreviousObjMesh=function(){this._meshesFromObj.length>0&&(this._handledMesh=this._meshesFromObj[this._meshesFromObj.length-1],this._unwrapData(),this._indicesForBabylon.reverse(),this._handledMesh.indices=this._indicesForBabylon.slice(),this._handledMesh.positions=this._unwrappedPositionsForBabylon.slice(),this._handledMesh.normals=this._unwrappedNormalsForBabylon.slice(),this._handledMesh.uvs=this._unwrappedUVForBabylon.slice(),this._loadingOptions.importVertexColors&&(this._handledMesh.colors=this._unwrappedColorsForBabylon.slice()),this._indicesForBabylon.length=0,this._unwrappedPositionsForBabylon.length=0,this._unwrappedColorsForBabylon.length=0,this._unwrappedNormalsForBabylon.length=0,this._unwrappedUVForBabylon.length=0)},t.prototype._optimizeNormals=function(t){var e=t.getVerticesData(s.VertexBuffer.PositionKind),i=t.getVerticesData(s.VertexBuffer.NormalKind),r={};if(e&&i){for(var o=0;o<e.length/3;o++)(l=r[n=e[3*o+0]+"_"+e[3*o+1]+"_"+e[3*o+2]])||(l=[],r[n]=l),l.push(o);var a=new s.Vector3;for(var n in r){var l;if(!((l=r[n]).length<2)){var h=l[0];for(o=1;o<l.length;++o){var p=l[o];i[3*h+0]+=i[3*p+0],i[3*h+1]+=i[3*p+1],i[3*h+2]+=i[3*p+2]}for(a.copyFromFloats(i[3*h+0],i[3*h+1],i[3*h+2]),a.normalize(),o=0;o<l.length;++o)i[3*(p=l[o])+0]=a.x,i[3*p+1]=a.y,i[3*p+2]=a.z}}t.setVerticesData(s.VertexBuffer.NormalKind,i)}},t.prototype.parse=function(e,i,r,o,a){for(var n,l=i.split("\n"),h=0;h<l.length;h++){var p=l[h].trim().replace(/\s\s/g," "),_=void 0;if(0!==p.length&&"#"!==p.charAt(0))if(t.VertexPattern.test(p)){if(_=p.match(/[^ ]+/g),this._positions.push(new s.Vector3(parseFloat(_[1]),parseFloat(_[2]),parseFloat(_[3]))),this._loadingOptions.importVertexColors)if(_.length>=7){var d=parseFloat(_[4]),u=parseFloat(_[5]),m=parseFloat(_[6]);this._colors.push(new s.Color4(d>1?d/255:d,u>1?u/255:u,m>1?m/255:m,7===_.length||void 0===_[7]?1:parseFloat(_[7])))}else this._colors.push(this._grayColor)}else if(null!==(_=t.NormalPattern.exec(p)))this._normals.push(new s.Vector3(parseFloat(_[1]),parseFloat(_[2]),parseFloat(_[3])));else if(null!==(_=t.UVPattern.exec(p)))this._uvs.push(new s.Vector2(parseFloat(_[1])*this._loadingOptions.UVScaling.x,parseFloat(_[2])*this._loadingOptions.UVScaling.y));else if(null!==(_=t.FacePattern3.exec(p)))this._setDataForCurrentFaceWithPattern3(_[1].trim().split(" "),1);else if(null!==(_=t.FacePattern4.exec(p)))this._setDataForCurrentFaceWithPattern4(_[1].trim().split(" "),1);else if(null!==(_=t.FacePattern5.exec(p)))this._setDataForCurrentFaceWithPattern5(_[1].trim().split(" "),1);else if(null!==(_=t.FacePattern2.exec(p)))this._setDataForCurrentFaceWithPattern2(_[1].trim().split(" "),1);else if(null!==(_=t.FacePattern1.exec(p)))this._setDataForCurrentFaceWithPattern1(_[1].trim().split(" "),1);else if(t.GroupDescriptor.test(p)||t.ObjectDescriptor.test(p)){var c={name:p.substring(2).trim(),indices:void 0,positions:void 0,normals:void 0,uvs:void 0,colors:void 0,materialName:this._materialNameFromObj};this._addPreviousObjMesh(),this._meshesFromObj.push(c),this._hasMeshes=!0,this._isFirstMaterial=!0,this._increment=1}else t.UseMtlDescriptor.test(p)?(this._materialNameFromObj=p.substring(7).trim(),this._isFirstMaterial&&this._hasMeshes||(this._addPreviousObjMesh(),c={name:(this._objMeshName||"mesh")+"_mm"+this._increment.toString(),indices:void 0,positions:void 0,normals:void 0,uvs:void 0,colors:void 0,materialName:this._materialNameFromObj},this._increment++,this._meshesFromObj.push(c),this._hasMeshes=!0),this._hasMeshes&&this._isFirstMaterial&&(this._meshesFromObj[this._meshesFromObj.length-1].materialName=this._materialNameFromObj,this._isFirstMaterial=!1)):t.MtlLibGroupDescriptor.test(p)?a(p.substring(7).trim()):t.SmoothDescriptor.test(p)||console.log("Unhandled expression at line : "+p)}if(this._hasMeshes&&(this._handledMesh=this._meshesFromObj[this._meshesFromObj.length-1],this._indicesForBabylon.reverse(),this._unwrapData(),this._handledMesh.indices=this._indicesForBabylon,this._handledMesh.positions=this._unwrappedPositionsForBabylon,this._handledMesh.normals=this._unwrappedNormalsForBabylon,this._handledMesh.uvs=this._unwrappedUVForBabylon,this._loadingOptions.importVertexColors&&(this._handledMesh.colors=this._unwrappedColorsForBabylon)),!this._hasMeshes){var f=null;if(this._indicesForBabylon.length)this._indicesForBabylon.reverse(),this._unwrapData();else{for(var b=0,F=this._positions;b<F.length;b++){var y=F[b];this._unwrappedPositionsForBabylon.push(y.x,y.y,y.z)}if(this._normals.length)for(var g=0,v=this._normals;g<v.length;g++){var O=v[g];this._unwrappedNormalsForBabylon.push(O.x,O.y,O.z)}if(this._uvs.length)for(var w=0,M=this._uvs;w<M.length;w++){var T=M[w];this._unwrappedUVForBabylon.push(T.x,T.y)}if(this._colors.length)for(var P=0,B=this._colors;P<B.length;P++){var x=B[P];this._unwrappedColorsForBabylon.push(x.r,x.g,x.b,x.a)}this._materialNameFromObj||((f=new s.StandardMaterial(s.Geometry.RandomId(),r)).pointsCloud=!0,this._materialNameFromObj=f.name,this._normals.length||(f.disableLighting=!0,f.emissiveColor=s.Color3.White()))}this._meshesFromObj.push({name:s.Geometry.RandomId(),indices:this._indicesForBabylon,positions:this._unwrappedPositionsForBabylon,colors:this._unwrappedColorsForBabylon,normals:this._unwrappedNormalsForBabylon,uvs:this._unwrappedUVForBabylon,materialName:this._materialNameFromObj,directMaterial:f})}for(var C=0;C<this._meshesFromObj.length;C++){if(e&&this._meshesFromObj[C].name)if(e instanceof Array){if(-1===e.indexOf(this._meshesFromObj[C].name))continue}else if(this._meshesFromObj[C].name!==e)continue;this._handledMesh=this._meshesFromObj[C],r._blockEntityCollection=!!o;var N=new s.Mesh(this._meshesFromObj[C].name,r);if(N._parentContainer=o,r._blockEntityCollection=!1,this._materialToUse.push(this._meshesFromObj[C].materialName),0!==(null===(n=this._handledMesh.positions)||void 0===n?void 0:n.length)){var I=new s.VertexData;if(I.uvs=this._handledMesh.uvs,I.indices=this._handledMesh.indices,I.positions=this._handledMesh.positions,this._loadingOptions.computeNormals){var V=new Array;s.VertexData.ComputeNormals(this._handledMesh.positions,this._handledMesh.indices,V),I.normals=V}else I.normals=this._handledMesh.normals;this._loadingOptions.importVertexColors&&(I.colors=this._handledMesh.colors),I.applyToMesh(N),this._loadingOptions.invertY&&(N.scaling.y*=-1),this._loadingOptions.optimizeNormals&&this._optimizeNormals(N),this._babylonMeshesArray.push(N),this._handledMesh.directMaterial&&(N.material=this._handledMesh.directMaterial)}else this._babylonMeshesArray.push(N)}},t.ObjectDescriptor=/^o/,t.GroupDescriptor=/^g/,t.MtlLibGroupDescriptor=/^mtllib /,t.UseMtlDescriptor=/^usemtl /,t.SmoothDescriptor=/^s /,t.VertexPattern=/v(\s+[\d|.|+|\-|e|E]+){3,7}/,t.NormalPattern=/vn(\s+[\d|.|+|\-|e|E]+)( +[\d|.|+|\-|e|E]+)( +[\d|.|+|\-|e|E]+)/,t.UVPattern=/vt(\s+[\d|.|+|\-|e|E]+)( +[\d|.|+|\-|e|E]+)/,t.FacePattern1=/f\s+(([\d]{1,}[\s]?){3,})+/,t.FacePattern2=/f\s+((([\d]{1,}\/[\d]{1,}[\s]?){3,})+)/,t.FacePattern3=/f\s+((([\d]{1,}\/[\d]{1,}\/[\d]{1,}[\s]?){3,})+)/,t.FacePattern4=/f\s+((([\d]{1,}\/\/[\d]{1,}[\s]?){3,})+)/,t.FacePattern5=/f\s+(((-[\d]{1,}\/-[\d]{1,}\/-[\d]{1,}[\s]?){3,})+)/,t}(),n=function(){function t(e){this.name="obj",this.extensions=".obj",this._assetContainer=null,this._loadingOptions=e||t._DefaultLoadingOptions}return Object.defineProperty(t,"INVERT_TEXTURE_Y",{get:function(){return o.INVERT_TEXTURE_Y},set:function(t){o.INVERT_TEXTURE_Y=t},enumerable:!1,configurable:!0}),Object.defineProperty(t,"_DefaultLoadingOptions",{get:function(){return{computeNormals:t.COMPUTE_NORMALS,optimizeNormals:t.OPTIMIZE_NORMALS,importVertexColors:t.IMPORT_VERTEX_COLORS,invertY:t.INVERT_Y,invertTextureY:t.INVERT_TEXTURE_Y,UVScaling:t.UV_SCALING,materialLoadingFailsSilently:t.MATERIAL_LOADING_FAILS_SILENTLY,optimizeWithUV:t.OPTIMIZE_WITH_UV,skipMaterials:t.SKIP_MATERIALS}},enumerable:!1,configurable:!0}),t.prototype._loadMTL=function(t,e,i,r){var o=e+t;s.Tools.LoadFile(o,i,void 0,void 0,!1,(function(t,e){r(o,e)}))},t.prototype.createPlugin=function(){return new t(t._DefaultLoadingOptions)},t.prototype.canDirectLoad=function(){return!1},t.prototype.importMeshAsync=function(t,e,s,i){return this._parseSolid(t,e,s,i).then((function(t){return{meshes:t,particleSystems:[],skeletons:[],animationGroups:[],transformNodes:[],geometries:[],lights:[]}}))},t.prototype.loadAsync=function(t,e,s){return this.importMeshAsync(null,t,e,s).then((function(){}))},t.prototype.loadAssetContainerAsync=function(t,e,i){var r=this,o=new s.AssetContainer(t);return this._assetContainer=o,this.importMeshAsync(null,t,e,i).then((function(t){return t.meshes.forEach((function(t){return o.meshes.push(t)})),t.meshes.forEach((function(t){var e=t.material;e&&-1==o.materials.indexOf(e)&&(o.materials.push(e),e.getActiveTextures().forEach((function(t){-1==o.textures.indexOf(t)&&o.textures.push(t)})))})),r._assetContainer=null,o})).catch((function(t){throw r._assetContainer=null,t}))},t.prototype._parseSolid=function(t,e,i,r){var n=this,l="",h=new o,p=new Array,_=[];new a(p,_,this._loadingOptions).parse(t,i,e,this._assetContainer,(function(t){l=t}));var d=[];return""===l||this._loadingOptions.skipMaterials||d.push(new Promise((function(t,i){n._loadMTL(l,r,(function(o){try{h.parseMTL(e,o,r,n._assetContainer);for(var a=0;a<h.materials.length;a++){for(var d=0,u=[],m=void 0;(m=p.indexOf(h.materials[a].name,d))>-1;)u.push(m),d=m+1;if(-1===m&&0===u.length)h.materials[a].dispose();else for(var c=0;c<u.length;c++){var f=_[u[c]],b=h.materials[a];f.material=b,f.getTotalIndices()||(b.pointsCloud=!0)}}t()}catch(e){s.Tools.Warn("Error processing MTL file: '".concat(l,"'")),n._loadingOptions.materialLoadingFailsSilently?t():i(e)}}),(function(e,r){s.Tools.Warn("Error downloading MTL file: '".concat(l,"'")),n._loadingOptions.materialLoadingFailsSilently?t():i(r)}))}))),Promise.all(d).then((function(){return _}))},t.OPTIMIZE_WITH_UV=!0,t.INVERT_Y=!1,t.IMPORT_VERTEX_COLORS=!1,t.COMPUTE_NORMALS=!1,t.OPTIMIZE_NORMALS=!1,t.UV_SCALING=new s.Vector2(1,1),t.SKIP_MATERIALS=!1,t.MATERIAL_LOADING_FAILS_SILENTLY=!0,t}();s.SceneLoader&&s.SceneLoader.RegisterPlugin(new n);var l=void 0!==i.g?i.g:"undefined"!=typeof window?window:void 0;if(void 0!==l)for(var h in t)l.BABYLON[h]||(l.BABYLON[h]=t[h]);const p=e})(),r.default})()));
//# sourceMappingURL=babylon.objFileLoader.min.js.map